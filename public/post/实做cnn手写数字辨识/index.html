<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>实做CNN手写数字辨识 - 专心打杂</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="开始 语言：Python2 框架：Keras Backend: tensorflow OS: Archlinux Package: numpy,pandas,seaborn,sklearn,etc Method: CPU(i7) 数据集: MNIST 模型结构： In -&gt; [[Conv2D-&gt;relu]*2 -&gt; MaxPool2D -&gt; Dropout]*2 -&gt; Flatten -&gt; Dense -&gt; Dropout -&gt; Out. 现在让我们在Ipython里面跑。">
  
  <meta itemprop="name" content="实做CNN手写数字辨识 - 专心打杂">
  <meta itemprop="description" content="开始 语言：Python2 框架：Keras Backend: tensorflow OS: Archlinux Package: numpy,pandas,seaborn,sklearn,etc Method: CPU(i7) 数据集: MNIST 模型结构： In -&gt; [[Conv2D-&gt;relu]*2 -&gt; MaxPool2D -&gt; Dropout]*2 -&gt; Flatten -&gt; Dense -&gt; Dropout -&gt; Out. 现在让我们在Ipython里面跑。">
  <meta itemprop="image" content="http://xrazor.org/img/author.jpg">
  
  
  <meta name="twitter:description" content="">
  
  <link rel="shortcut icon" href="http://xrazor.org/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="http://xrazor.org/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="http://xrazor.org/apple-touch-icon.png" />
  <link rel="stylesheet" href="http://xrazor.org/highlight/styles/github.css">
  <script src="http://xrazor.org/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="http://xrazor.org/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="http://xrazor.org/css/style.css">
</head>

<body>
  <header>
    <div>
  
  <div id="imglogo">
    <a href="http://xrazor.org/"><img src="http://xrazor.org/img/logo.svg" alt="专心打杂" title="专心打杂"/></a>
  </div>
  
  <div id="textlogo">
    <h1 class="site-name"><a href="http://xrazor.org/" title="专心打杂">专心打杂</a></h1>
    <h2 class="blog-motto">客户端 前后端 操作系统 golang c/c&#43;&#43; 各种脚本，努力做全栈</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">Rencent</a></li>
      
      <li><a href="/tags/">Tags</a></li>
      
      <li><a href="/skilltree/">SkillTree</a></li>
      
      <li><a href="/bookmarks/">BookMarks</a></li>
      
      <li><a href="/about/">About</a></li>
      
      <li><a href="/contact/">Contact</a></li>
      
      <li>
			<div id="so360">
				<form  class="search" action="https://www.so.com/s" target="_blank" id="so360form">
					<input type="text" autocomplete="off" name="q" id="so360_keyword">
					<input type="submit" id="so360_submit" value="搜 索">
					<input type="hidden" name="ie" value="utf8">
					<input type="hidden" name="src" value="zz_https://oser.space/">
					<input type="hidden" name="site" value=https://oser.space/>
					<input type="hidden" name="rg" value="1">
				</form>
			</div>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="http://xrazor.org/post/%E5%AE%9E%E5%81%9Acnn%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%BE%A8%E8%AF%86/" title="实做CNN手写数字辨识" itemprop="url">实做CNN手写数字辨识</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://oser.space/" title=""></a>
    
  </p>
  <p class="article-time">
    <time datetime="2017-06-25 23:04:01 &#43;0800 CST" itemprop="datePublished">2017年06月25日</time>
  </p>
</header>

	<div class="article-content">
    
    

<h1 id="开始">开始</h1>

<div align=center><img src="http://markdown0327.oss-cn-beijing.aliyuncs.com/18-3-18/3017240.jpg"/></div> 

<ul>
<li>语言：Python2</li>
<li>框架：Keras</li>
<li>Backend: tensorflow</li>
<li>OS: Archlinux</li>
<li>Package: numpy,pandas,seaborn,sklearn,etc</li>
<li>Method: CPU(i7)</li>
<li>数据集: MNIST</li>
</ul>

<p>模型结构：</p>

<pre><code>In -&gt; [[Conv2D-&gt;relu]*2 -&gt; MaxPool2D -&gt; Dropout]*2 -&gt; Flatten -&gt; Dense -&gt; Dropout -&gt; Out.
</code></pre>

<p>现在让我们在Ipython里面跑。</p>

<h1 id="数据预处理">数据预处理</h1>

<h3 id="import各种包">import各种包</h3>

<pre><code class="language-python">import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import matplotlib.image as mpimg
import seaborn as sns

np.random.seed(2) # seed中使用数字相同，则每次程序中生成的随机数都相同

from sklearn.model_selection import train_test_split
from sklearn.metrics import confusion_matrix
import itertools

from keras.utils.np_utils import to_categorical # convert to one-hot-encoding
from keras.models import Sequential
from keras.layers import Dense, Dropout, Flatten, Conv2D, MaxPool2D
from keras.optimizers import RMSprop
from keras.preprocessing.image import ImageDataGenerator
from keras.callbacks import ReduceLROnPlateau 

sns.set(style='white', context='notebook', palette='deep')
</code></pre>

<h3 id="载入数据">载入数据</h3>

<pre><code class="language-python">train = pd.read_csv(&quot;../data/train.csv&quot;)
test = pd.read_csv(&quot;../data/test.csv&quot;)
</code></pre>

<pre><code class="language-python">Y_train = train[&quot;label&quot;]
X_train = train.drop(labels = [&quot;label&quot;],axis = 1) 

g = sns.countplot(Y_train) # 看一看各标签大致分布情况
Y_train.value_counts() 
</code></pre>

<div align=center><img src="http://markdown0327.oss-cn-beijing.aliyuncs.com/18-3-18/32508221.jpg"/></div>

<p>总共0-9 10个数字，可以看出分布都差不多。</p>

<h3 id="检查空值-缺失值">检查空值/缺失值</h3>

<p>mnist是处理好的数据集，不会有缺失的情况，但是这个检查步骤要形成习惯。</p>

<pre><code class="language-python">X_train.isnull().any().describe()
</code></pre>

<h3 id="归一化">归一化</h3>

<p>mnist是黑白的，因此这里做的是灰度归一化(grey scale),归一化的作用有2个：</p>

<ul>
<li>减小照度带来的差异</li>
<li>加快模型训练速度</li>
</ul>

<pre><code class="language-python">X_train = X_train / 255.0
test = test / 255.0
</code></pre>

<h3 id="reshape">Reshape</h3>

<pre><code class="language-python">X_train = X_train.values.reshape(-1,28,28,1)
test = test.values.reshape(-1,28,28,1)
</code></pre>

<p>pandas 导进来的数据是784长度的1D vector， 我们要将其转为28 * 28 的3D metrices, 因为是黑白图片所以通道数只有1， 如果是彩色的，则RGB通道就是3.</p>

<h3 id="对labels进行one-hot编码">对labels进行one-hot编码</h3>

<p>keras里面自带的就有，直接用。</p>

<pre><code class="language-python">Y_train = to_categorical(Y_train, num_classes = 10) # (ex : 2 -&gt; [0,0,1,0,0,0,0,0,0,0])
</code></pre>

<p>one-hot的作用在于：它使距离计算或相似度计算更合理了。</p>

<h3 id="划分训练集和验证集-validation-set">划分训练集和验证集(validation set)</h3>

<p>这里用sklearn的方法，很方便。</p>

<pre><code class="language-python">random_seed = 2
X_train, X_val, Y_train, Y_val = train_test_split(X_train, Y_train, test_size = 0.2, random_state=random_seed)
</code></pre>

<p>这里训练集和验证集是8:2， 注意：这里是随机分，能随机分的前提是各个labels的分布比较均匀， 对于一些有偏斜的类，直接像上面这样random可能结果会变得很糟糕，应对之法是在train_test_split中多加一个参数stratify，它使validation之后的分布仍和之前的分布一样。</p>

<h1 id="训练模型">训练模型</h1>

<h3 id="cnn">CNN</h3>

<p>这里keras的后端用的是tensorflow，众所周知采用的是先架“管道”后通“水”的运作方式，先定义图，再将数据导入。
对于CNN模型的搭建，我们使用keras中的Sequential API操作，搭建的方式也非常符合”直觉“，需要什么层就按顺序添加就好。
再来看看我们之前说的神经网络结构：</p>

<pre><code>In -&gt; [[Conv2D-&gt;relu]*2 -&gt; MaxPool2D -&gt; Dropout]*2 -&gt; Flatten -&gt; Dense -&gt; Dropout -&gt; Out
</code></pre>

<p>CNN有”四大神兽“：</p>

<ul>
<li>先是<strong>卷积层</strong>(convelutional layer)。卷积层有几个核心的参数需要设定，一是filters的数量，每一个filters都会学习某一种特征，比如说有的学“撇”、有的学“捺”、有的学”竖“&hellip;， 而到了第二个卷积层的时候所学的特征就会比第一层卷积更”高级“， 比如说已经可以学习到一些连笔之类的， 这些filters学出来的东西又组合成一个矩阵叫feature map，供下一层作为input。总之我们这里前后各有2个卷积层，前面的filters是32个，后面的是64个。</li>
<li>第二是<strong>池化层</strong>(pooling layer), 它的作用是一个下采样器（downsampling）,比如一个size是(2, 2)的maxpooling filter就是从一个2*2的方块中选出最大的那个数字，然后移动到下一个方块，maxpooling filter的移动一般是不overlap的。它的作用一是减少参数，加快训练；二是减少过拟合几率，增强泛化能力。</li>
<li>三是<strong>Dropout层</strong>（不知道怎么翻译），这是一个正则化的方法，在CNN的开山论文中被提出，作用是减少过拟合，它的工作就是按概率让神经网络中的某些神经元失效。</li>
<li>最后是<strong>激活层</strong>(activation layer), 它为整个神经网络引入非线性的特征，我们这里用的是ReLU(max(0, x))。</li>
</ul>

<p>另外， flatten 层的作用是把前一层卷积/池化得到的featuremap展平成1维， 让后面的全连接层可以用。
最后我们用softmax来输出各分类的概率。</p>

<pre><code class="language-python">model = Sequential()

model.add(Conv2D(filters = 32, kernel_size = (5,5),padding = 'Same', 
                 activation ='relu', input_shape = (28,28,1)))
model.add(Conv2D(filters = 32, kernel_size = (5,5),padding = 'Same', 
                 activation ='relu'))
model.add(MaxPool2D(pool_size=(2,2)))
model.add(Dropout(0.25))

model.add(Conv2D(filters = 64, kernel_size = (3,3),padding = 'Same', 
                 activation ='relu'))
model.add(Conv2D(filters = 64, kernel_size = (3,3),padding = 'Same', 
                 activation ='relu'))
model.add(MaxPool2D(pool_size=(2,2), strides=(2,2)))
model.add(Dropout(0.25))

model.add(Flatten())
model.add(Dense(256, activation = &quot;relu&quot;))
model.add(Dropout(0.5))
model.add(Dense(10, activation = &quot;softmax&quot;))
</code></pre>

<h3 id="优化器">优化器</h3>

<p>机器学习方法= 模型+策略+算法， 现在模型已经搞定了，还剩策略和算法。策略是指如何评价一个模型的好坏，算法是指我们怎么计算能够又快又好的找到一个解。具体地，就是要定义loss function和optimization算法, optimization 一定是能不断减小loss function的。
这里我们的loss function选用交叉熵, 即categorical_crossentropy, 优化算法选RMSprop，比SGD高效。</p>

<pre><code class="language-python">optimizer = RMSprop(lr=0.001, rho=0.9, epsilon=1e-08, decay=0.0)
# 编译模型
model.compile(optimizer = optimizer , loss = &quot;categorical_crossentropy&quot;, metrics=[&quot;accuracy&quot;])
</code></pre>

<p>这样模型就编译好了。</p>

<p><strong>One more thing&hellip;</strong>
为了让优化器收敛更快， 我们需要对一个关键参数——学习率（learning rate）用退火法处理。原理上来说，学习率越大，参数更新得越快，然而事实是有时候步子迈大了容易陷入一个局部最小的趋于， 在里面来回逛。因此我们需要一个逐步变小的学习率。怎么变呢？如果正确率不再提高，那么我们设定3个周期后自动将学习率将至原来的一半。这里通过调用ReduceLROnPlateau方法可以实现。这是一个回调函数，回调函数就是在迭代过程中某一时刻会按条件触发的函数。</p>

<pre><code class="language-python">learning_rate_reduction = ReduceLROnPlateau(monitor='val_acc', # 监测指标
                                            patience=3, # 等待周期
                                            verbose=1, 
                                            factor=0.5, # 每次衰减幅度
                                            min_lr=0.00001 # 学习率下限)
</code></pre>

<p>这里我们同时设立一下epoch和batch，batch就是一次看多少个样本，epoch就是一个batch看几遍。</p>

<pre><code class="language-python">epochs = 15
batch_size = 86
</code></pre>

<h3 id="数据增强-data-augmentation">数据增强(Data augmentation)</h3>

<p>为了增强模型的泛化能力，我们希望它能多看一下数据，但是原本的数据就这么大，怎么办呢，我们可以在原本的数据集上做一些微小的改动，给他们增加一些noise，这样就等于有了更多的feature。这个是一个压箱底的”大杀器“，使用后可明显提高性能。常用的Data augmentation包括但不限于：</p>

<ul>
<li>灰度缩放grayscales</li>
<li>水平翻转horizontal flips</li>
<li>垂直翻转vertical flips</li>
<li>随机裁剪random crops</li>
<li>颜色抖动color jitters</li>
<li>旋转rotations</li>
</ul>

<p>还是调用现成的方法：</p>

<pre><code class="language-python">datagen = ImageDataGenerator(
        featurewise_center=False,  # set input mean to 0 over the dataset
        samplewise_center=False,  # set each sample mean to 0
        featurewise_std_normalization=False,  # divide inputs by std of the dataset
        samplewise_std_normalization=False,  # divide each input by its std
        zca_whitening=False,  # apply ZCA whitening
        rotation_range=10,  # randomly rotate images in the range (degrees, 0 to 180)
        zoom_range = 0.1, # Randomly zoom image 
        width_shift_range=0.1,  # randomly shift images horizontally (fraction of total width)
        height_shift_range=0.1,  # randomly shift images vertically (fraction of total height)
        horizontal_flip=False,  # randomly flip images
        vertical_flip=False)  # randomly flip images

datagen.fit(X_train)
</code></pre>

<p>我们这里采用的有那么几招：</p>

<ul>
<li>随机旋转10°</li>
<li>随机缩放10%</li>
<li>随机水平拉伸10%</li>
<li>随机垂直拉伸10%</li>
</ul>

<h3 id="是时候train一发了">是时候train一发了</h3>

<p>把刚才的退火法lr回调函数写进callbacks里，train之。</p>

<pre><code class="language-python">history = model.fit_generator(datagen.flow(X_train,Y_train, batch_size=batch_size),
                              epochs = epochs, validation_data = (X_val,Y_val),
                              verbose = 2, steps_per_epoch=X_train.shape[0] // batch_size
                              , callbacks=[learning_rate_reduction])
</code></pre>

<p>注意这里用的是model.fit_generator, 如果是model.fit就是直接把数据一把load进内存中，这个对于使用gpu计算的情况，数据集太大的话有可能会把显存撑爆。
接下来让我们看一看结果&gt;&gt;&gt;&gt;&gt;</p>

<pre><code> - 110s - loss: 0.5793 - acc: 0.8131 - val_loss: 0.0908 - val_acc: 0.9712
Epoch 2/15
 - 103s - loss: 0.1894 - acc: 0.9434 - val_loss: 0.0935 - val_acc: 0.9678
Epoch 3/15
 - 103s - loss: 0.1374 - acc: 0.9585 - val_loss: 0.0380 - val_acc: 0.9886
Epoch 4/15
 - 106s - loss: 0.1070 - acc: 0.9685 - val_loss: 0.0457 - val_acc: 0.9853
Epoch 5/15
 - 104s - loss: 0.0958 - acc: 0.9711 - val_loss: 0.0387 - val_acc: 0.9886
Epoch 6/15
 - 104s - loss: 0.0888 - acc: 0.9747 - val_loss: 0.0354 - val_acc: 0.9909
Epoch 7/15
 - 104s - loss: 0.0761 - acc: 0.9766 - val_loss: 0.0399 - val_acc: 0.9893
Epoch 8/15
 - 104s - loss: 0.0806 - acc: 0.9757 - val_loss: 0.0289 - val_acc: 0.9919
Epoch 9/15
 - 104s - loss: 0.0703 - acc: 0.9797 - val_loss: 0.0328 - val_acc: 0.9886
Epoch 10/15
 - 104s - loss: 0.0695 - acc: 0.9791 - val_loss: 0.0378 - val_acc: 0.9899
Epoch 11/15
 - 104s - loss: 0.0686 - acc: 0.9803 - val_loss: 0.0314 - val_acc: 0.9914
Epoch 12/15

Epoch 00012: reducing learning rate to 0.000500000023749.
 - 104s - loss: 0.0633 - acc: 0.9801 - val_loss: 0.0329 - val_acc: 0.9907
Epoch 13/15
 - 104s - loss: 0.0519 - acc: 0.9853 - val_loss: 0.0257 - val_acc: 0.9929
Epoch 14/15
 - 104s - loss: 0.0523 - acc: 0.9848 - val_loss: 0.0276 - val_acc: 0.9912
Epoch 15/15
 - 104s - loss: 0.0514 - acc: 0.9856 - val_loss: 0.0295 - val_acc: 0.9932

</code></pre>

<p>没用gpu，跑了半个多小时，这里我们train了15个epoch，loss和acc是训练集上的，val_loss和val_acc是验证集上的，可以看到一开始训练集比验证集上的acc要差，这是因为我们做了data augmentation，导致看训练集识别的难度有所提升。另外在epoch=12时触发了回调函数，调整了学习率，最终我们的acc在验证集上做到了0.9932，勉强可以，如果epoch更高应该会有更好的表现，这里为了节省时间只跑了15个epoch。</p>

<h1 id="模型评估">模型评估</h1>

<h3 id="画loss和acc曲线">画loss和acc曲线</h3>

<pre><code class="language-python">fig, ax = plt.subplots(2,1)
ax[0].plot(history.history['loss'], color='b', label=&quot;Training loss&quot;)
ax[0].plot(history.history['val_loss'], color='r', label=&quot;validation loss&quot;,axes =ax[0])
legend = ax[0].legend(loc='best', shadow=True)

ax[1].plot(history.history['acc'], color='b', label=&quot;Training accuracy&quot;)
ax[1].plot(history.history['val_acc'], color='r',label=&quot;Validation accuracy&quot;)
legend = ax[1].legend(loc='best', shadow=True)
</code></pre>

<p><div align=center><img src="http://markdown0327.oss-cn-beijing.aliyuncs.com/18-3-18/64903322.jpg"/></div>
在15个epoch里面，validation set 的acc一直略微高于training set的，说明没有过拟合，模型训练得不错。</p>

<h3 id="画混淆矩阵-confusion-matrix">画混淆矩阵(Confusion Matrix)</h3>

<p>混淆矩阵的一轴表示预测下的分类样本数，另一轴表示实际的分类样本数，通过混淆矩阵我们可以直观的判断哪些地方误分类较为严重。这里我们选用validation set的数据来做。</p>

<pre><code class="language-python">def plot_confusion_matrix(cm, classes,
                          normalize=False,
                          title='Confusion matrix',
                          cmap=plt.cm.Blues):
    &quot;&quot;&quot;
    This function prints and plots the confusion matrix.
    Normalization can be applied by setting `normalize=True`.
    &quot;&quot;&quot;
    plt.imshow(cm, interpolation='nearest', cmap=cmap)
    plt.title(title)
    plt.colorbar()
    tick_marks = np.arange(len(classes))
    plt.xticks(tick_marks, classes, rotation=45)
    plt.yticks(tick_marks, classes)

    if normalize:
        cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]

    thresh = cm.max() / 2.
    for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):
        plt.text(j, i, cm[i, j],
                 horizontalalignment=&quot;center&quot;,
                 color=&quot;white&quot; if cm[i, j] &gt; thresh else &quot;black&quot;)

    plt.tight_layout()
    plt.ylabel('True label')
    plt.xlabel('Predicted label')

# Predict the values from the validation dataset
Y_pred = model.predict(X_val)
# Return the biggest num's index.
Y_pred_classes = np.argmax(Y_pred,axis = 1) 

Y_true = np.argmax(Y_val,axis = 1) 
# compute the confusion matrix
confusion_mtx = confusion_matrix(Y_true, Y_pred_classes) 
# plot the confusion matrix
plot_confusion_matrix(confusion_mtx, classes = range(10)) 
</code></pre>

<p><div align=center><img src="http://markdown0327.oss-cn-beijing.aliyuncs.com/18-3-18/60901388.jpg"/></div>
从混淆矩阵可以看出，大多数分类都还ok，只有9相对比较差，容易被误分为4。
让我们进一步看一看错误的典型。</p>

<pre><code class="language-python"># get errors bool array
errors = (Y_pred_classes - Y_true != 0)
# check which class is misclassification
Y_pred_classes_errors = Y_pred_classes[errors]
Y_pred_errors = Y_pred[errors]
Y_true_errors = Y_true[errors]
X_val_errors = X_val[errors]

def display_errors(errors_index,img_errors,pred_errors, obs_errors):
    &quot;&quot;&quot; This function shows 6 images with their predicted and real labels&quot;&quot;&quot;
    n = 0
    nrows = 2
    ncols = 3
    fig, ax = plt.subplots(nrows,ncols,sharex=True,sharey=True)
    for row in range(nrows):
        for col in range(ncols):
            error = errors_index[n]
            ax[row,col].imshow((img_errors[error]).reshape((28,28)))
            ax[row,col].set_title(&quot;Predicted label :{}\nTrue label :{}&quot;.format(pred_errors[error],obs_errors[error]))
            n += 1

# Probabilities of the wrong predicted numbers
Y_pred_errors_prob = np.max(Y_pred_errors,axis = 1)

# Predicted probabilities of the true values in the error set
true_prob_errors = np.diagonal(np.take(Y_pred_errors, Y_true_errors, axis=1))

# Difference between the probability of the predicted label and the true label
delta_pred_true_errors = Y_pred_errors_prob - true_prob_errors

# Sorted list of the delta prob errors
sorted_dela_errors = np.argsort(delta_pred_true_errors)

# Top 6 errors 
most_important_errors = sorted_dela_errors[-6:]

# Show the top 6 errors
display_errors(most_important_errors, X_val_errors, Y_pred_classes_errors, Y_true_errors)
</code></pre>

<p>好了，这里我们就找出来top6的错误：
<div align=center><img src="http://markdown0327.oss-cn-beijing.aliyuncs.com/18-3-18/16765960.jpg"/></div>
简直坑爹，那几个true label是9的人都会认错有木有，所以我们模型表现还是不错的。
OK, 今天就先到这里了。</p>

	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="http://xrazor.org/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0">机器学习&#34;</a>
  
</div>





  <div class="article-share" id="share">
    <div data-url="http://xrazor.org/post/%E5%AE%9E%E5%81%9Acnn%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%BE%A8%E8%AF%86/" data-title="实做CNN手写数字辨识" data-tsina="1689508020" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  






<section class="comment">
<div id="gitcontainer"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  id: "http://xrazor.org/post/%E5%AE%9E%E5%81%9Acnn%E6%89%8B%E5%86%99%E6%95%B0%E5%AD%97%E8%BE%A8%E8%AF%86/",
  owner: "oserz",
  repo: "https-oser.space",
  oauth: {
    client_id: "1111",
    client_secret: "1111",
  },
})
gitment.render('gitcontainer')
</script>
</section>


</div>

    <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
  



  

<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
      
			<li><a href="http://xrazor.org/tags/" title=""><sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/ctf_web" title="ctf_web">ctf_web<sup>2</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/python" title="python">python<sup>2</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/scala" title="scala">scala<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/web" title="web">web<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e5%9f%ba%e7%a1%80%e7%ae%97%e6%b3%95" title="基础算法">基础算法<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e5%b7%a5%e5%85%b7" title="工具">工具<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e5%bb%ba%e7%ab%99" title="建站">建站<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e6%95%b0%e5%ad%a6%e4%b9%8b%e7%be%8e" title="数学之美">数学之美<sup>3</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0" title="机器学习">机器学习<sup>7</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e7%96%91%e9%9a%be%e6%9d%82%e7%97%87" title="疑难杂症">疑难杂症<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e7%bc%96%e7%a8%8b%e7%bb%83%e6%89%8b" title="编程练手">编程练手<sup>3</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e7%bd%91%e7%bb%9c%e5%ae%89%e5%85%a8" title="网络安全">网络安全<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e8%87%aa%e6%88%91%e7%ae%a1%e7%90%86" title="自我管理">自我管理<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%b3%bb%e7%bb%9f" title="计算机系统">计算机系统<sup>1</sup></a></li>
      
			<li><a href="http://xrazor.org/tags/%e8%af%bb%e4%b9%a6" title="读书">读书<sup>2</sup></a></li>
      
		</ul>
</div>



  
  <div class="archiveslist">
    <p class="asidetitle">归档</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2018-05">2018年05月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2018-04">2018年04月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2018-02">2018年02月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2018-01">2018年01月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-12">2017年12月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-11">2017年11月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-10">2017年10月</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-07">2017年07月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-06">2017年06月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-05">2017年05月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-03">2017年03月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-02">2017年02月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2017-01">2017年01月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2016-12">2016年12月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2016-11">2016年11月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2016-08">2016年08月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2016-06">2016年06月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2016-03">2016年03月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://xrazor.org/post/#2016-02">2016年02月</a><span class="archive-list-count">1</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">标签云</p>
  <div class="tagcloudlist clearfix">
    
    <a href="http://xrazor.org/tags/" style="font-size: 12px;"></a>
    
    <a href="http://xrazor.org/tags/ctf_web" style="font-size: 12px;">ctf_web</a>
    
    <a href="http://xrazor.org/tags/python" style="font-size: 12px;">python</a>
    
    <a href="http://xrazor.org/tags/scala" style="font-size: 12px;">scala</a>
    
    <a href="http://xrazor.org/tags/web" style="font-size: 12px;">web</a>
    
    <a href="http://xrazor.org/tags/%e5%9f%ba%e7%a1%80%e7%ae%97%e6%b3%95" style="font-size: 12px;">基础算法</a>
    
    <a href="http://xrazor.org/tags/%e5%b7%a5%e5%85%b7" style="font-size: 12px;">工具</a>
    
    <a href="http://xrazor.org/tags/%e5%bb%ba%e7%ab%99" style="font-size: 12px;">建站</a>
    
    <a href="http://xrazor.org/tags/%e6%95%b0%e5%ad%a6%e4%b9%8b%e7%be%8e" style="font-size: 12px;">数学之美</a>
    
    <a href="http://xrazor.org/tags/%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0" style="font-size: 12px;">机器学习</a>
    
    <a href="http://xrazor.org/tags/%e7%96%91%e9%9a%be%e6%9d%82%e7%97%87" style="font-size: 12px;">疑难杂症</a>
    
    <a href="http://xrazor.org/tags/%e7%bc%96%e7%a8%8b%e7%bb%83%e6%89%8b" style="font-size: 12px;">编程练手</a>
    
    <a href="http://xrazor.org/tags/%e7%bd%91%e7%bb%9c%e5%ae%89%e5%85%a8" style="font-size: 12px;">网络安全</a>
    
    <a href="http://xrazor.org/tags/%e8%87%aa%e6%88%91%e7%ae%a1%e7%90%86" style="font-size: 12px;">自我管理</a>
    
    <a href="http://xrazor.org/tags/%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%b3%bb%e7%bb%9f" style="font-size: 12px;">计算机系统</a>
    
    <a href="http://xrazor.org/tags/%e8%af%bb%e4%b9%a6" style="font-size: 12px;">读书</a>
    
  </div>
</div>



</aside>
</div>

  </div>
  <footer><div id="footer" >
  
  <div class="line">
    <span></span>
    <div style='background:no-repeat url("http://xrazor.org/img/author.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  
  
  <section class="info">
    <p>Oser's Blog</p>
  </section>
  
  <div class="social-font clearfix">
    
    <a href="http://www.zhihu.com/people/ou-xie-te-36" target="_blank" title="zhihu"></a>
    
    
    <a href="http://weibo.com/wormz" target="_blank" title="weibo"></a>
    
    
    
    <a href="https://github.com/oserz" target="_blank" title="github"></a>
    
    
    
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/coderzh/hugo-pacman-theme" target="_blank" title="hugo-pacman-theme">hugo-pacman-theme</a> © 2018
    
    <a href="http://xrazor.org/" title="专心打杂">专心打杂</a>
    
  </p>
</div>
</footer>
  <script src="http://xrazor.org/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:http:\/\/xrazor.org\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="http://xrazor.org/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="http://xrazor.org/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?"+"1111";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
</html>
